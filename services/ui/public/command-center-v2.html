<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRUVESTA Command Center v2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/ui.css">
  <style>
    /* Page-specific overrides */
    .shell-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .shell-logo-icon {
      width: 32px;
      height: 32px;
      background: var(--cyan-500);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: rotate(3deg);
    }

    .shell-logo-icon svg {
      color: var(--slate-950);
      width: 18px;
      height: 18px;
    }

    .shell-logo-text {
      font-size: 1.125rem;
      font-weight: 700;
      color: white;
      letter-spacing: -0.02em;
    }

    .shell-logo-version {
      font-size: 0.625rem;
      color: var(--slate-500);
      font-family: 'JetBrains Mono', monospace;
      background: var(--slate-800);
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: 4px;
    }

    /* Embed container */
    .embed-container {
      width: 100%;
      height: calc(100vh - 120px);
      border: none;
      border-radius: var(--radius-lg);
      background: var(--slate-900);
    }

    .embed-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: var(--radius-lg);
    }

    /* Quick action buttons */
    .quick-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .quick-action-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: var(--radius-md);
      font-size: 0.8125rem;
      font-weight: 500;
      background: var(--slate-800);
      color: var(--slate-300);
      border: 1px solid var(--slate-700);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .quick-action-btn:hover {
      background: var(--slate-700);
      border-color: var(--slate-600);
    }

    .quick-action-btn svg {
      width: 14px;
      height: 14px;
    }

    /* Loading state */
    .loading-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--slate-900);
      border-radius: var(--radius-lg);
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--slate-700);
      border-top-color: var(--cyan-500);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Tab content wrapper */
    .tab-content-wrapper {
      position: relative;
      min-height: calc(100vh - 120px);
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <header class="shell-topbar">
    <div class="shell-topbar-left">
      <div class="shell-logo">
        <div class="shell-logo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
        </div>
        <span class="shell-logo-text">TRUVESTA</span>
        <span class="shell-logo-version">v2</span>
      </div>
      
      <span class="env-badge demo">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
        </svg>
        DEMO
      </span>
    </div>

    <div class="shell-topbar-right">
      <div class="quick-actions">
        <button class="quick-action-btn" id="btn-refresh" title="Refresh current view">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
            <path d="M3 3v5h5"/>
            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
            <path d="M16 21h5v-5"/>
          </svg>
          Refresh
        </button>
      </div>

      <div class="status-indicator">
        <span class="status-dot" id="shell-status-dot"></span>
        <span id="shell-status-text">Connected</span>
      </div>

      <div class="shell-topbar-links">
        <a href="/dashboard" target="_blank" title="Open Dashboard in new tab">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15,3 21,3 21,9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
          Dashboard
        </a>
        <a href="/api/health" target="_blank" title="API Health">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
          </svg>
          Health
        </a>
      </div>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="shell-layout">
    <!-- Sidebar Navigation -->
    <nav class="shell-sidebar">
      <div class="shell-sidebar-nav">
        <button class="shell-sidebar-item active" id="tab-dashboard" data-tab="dashboard" title="Dashboard Overview">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          <span>Dashboard</span>
        </button>

        <button class="shell-sidebar-item" id="tab-orders" data-tab="orders" title="Order Management">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
          <span>Orders</span>
        </button>

        <button class="shell-sidebar-item" id="tab-lps" data-tab="lps" title="LP Accounts">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
          <span>LPs</span>
        </button>

        <button class="shell-sidebar-item" id="tab-alerts" data-tab="alerts" title="Alerts & Notifications">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          <span>Alerts</span>
          <span class="item-badge" id="alerts-badge" style="display: none;">0</span>
        </button>

        <button class="shell-sidebar-item" id="tab-demo" data-tab="demo" title="Demo Controls">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="5,3 19,12 5,21 5,3"/>
          </svg>
          <span>Demo</span>
        </button>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="shell-main">
      <div class="tab-content-wrapper">
        <!-- Dashboard Tab -->
        <section class="tab-panel active" id="panel-dashboard">
          <div class="embed-container" id="embed-dashboard">
            <iframe src="/dashboard#embed" title="Dashboard" loading="lazy"></iframe>
          </div>
        </section>

        <!-- Orders Tab -->
        <section class="tab-panel" id="panel-orders">
          <div class="placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
            </svg>
            <h2>Orders Management</h2>
            <p>View and manage all trading orders. Coming in Phase 2.</p>
          </div>
        </section>

        <!-- LPs Tab -->
        <section class="tab-panel" id="panel-lps">
          <div class="placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            <h2>LP Accounts</h2>
            <p>Liquidity provider account management and snapshots. Coming in Phase 2.</p>
          </div>
        </section>

        <!-- Alerts Tab -->
        <section class="tab-panel" id="panel-alerts">
          <div class="placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
            <h2>Alerts</h2>
            <p>System alerts and notifications. Coming in Phase 2.</p>
          </div>
        </section>

        <!-- Demo Tab -->
        <section class="tab-panel" id="panel-demo">
          <div class="placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="5,3 19,12 5,21 5,3"/>
            </svg>
            <h2>Demo Controls</h2>
            <p>Demo scenario execution and controls. Coming in Phase 2.</p>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    (function() {
      'use strict';

      // Tab navigation
      const tabButtons = document.querySelectorAll('.shell-sidebar-item[data-tab]');
      const tabPanels = document.querySelectorAll('.tab-panel');

      function switchTab(tabId) {
        // Update buttons
        tabButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabId);
        });

        // Update panels
        tabPanels.forEach(panel => {
          const panelId = panel.id.replace('panel-', '');
          panel.classList.toggle('active', panelId === tabId);
        });

        // Update URL hash without triggering navigation
        history.replaceState(null, '', `#${tabId}`);
      }

      // Tab click handlers
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          switchTab(btn.dataset.tab);
        });
      });

      // Handle initial hash
      function handleInitialHash() {
        const hash = window.location.hash.replace('#', '');
        const validTabs = ['dashboard', 'orders', 'lps', 'alerts', 'demo'];
        if (hash && validTabs.includes(hash)) {
          switchTab(hash);
        }
      }

      // Refresh button
      const refreshBtn = document.getElementById('btn-refresh');
      refreshBtn.addEventListener('click', () => {
        const activePanel = document.querySelector('.tab-panel.active');
        const iframe = activePanel.querySelector('iframe');
        if (iframe) {
          iframe.src = iframe.src;
        } else {
          window.location.reload();
        }
      });

      // Status check
      async function checkStatus() {
        const dot = document.getElementById('shell-status-dot');
        const text = document.getElementById('shell-status-text');
        
        try {
          const response = await fetch('/api/health', { timeout: 5000 });
          if (response.ok) {
            dot.className = 'status-dot';
            text.textContent = 'Connected';
          } else {
            dot.className = 'status-dot warning';
            text.textContent = 'Degraded';
          }
        } catch (error) {
          dot.className = 'status-dot error';
          text.textContent = 'Disconnected';
        }
      }

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.altKey && e.key >= '1' && e.key <= '5') {
          e.preventDefault();
          const tabs = ['dashboard', 'orders', 'lps', 'alerts', 'demo'];
          const index = parseInt(e.key) - 1;
          if (tabs[index]) {
            switchTab(tabs[index]);
          }
        }
      });

      // Initialize
      handleInitialHash();
      checkStatus();
      setInterval(checkStatus, 30000);

      // Expose API for programmatic control
      window.CommandCenterV2 = {
        switchTab,
        refresh: () => refreshBtn.click()
      };
    })();
  </script>
</body>
</html>
